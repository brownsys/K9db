# Optional per-user config goes into user.bazelrc, which is .gitignore-ed.
try-import user.bazelrc

build --cxxopt="-std=c++17"
build --host_cxxopt="-std=c++17"
build --copt -g
build --host_copt -g

build:asan --strip=never
build:asan --copt -fsanitize=address
build:asan --copt -g
build:asan --copt -O1
build:asan --copt -fno-omit-frame-pointer
build:asan --linkopt -fsanitize=address

# For running under valgrind
build:valgrind --strip=never
build:valgrind --copt -g
build:valgrind --copt -DPELTON_VALGRIND_MODE
test:valgrind --run_under "valgrind --error-exitcode=1 --leak-check=full"
test:valgrind --test_output all
run:valgrind --run_under "valgrind --error-exitcode=1 --errors-for-leak-kinds=definite --leak-check=full --show-leak-kinds=definite"

# Optimized build.
build:opt -c opt  # use bazel default opt config
build:opt --copt -DPELTON_OPT
build:opt --host_copt -DPELTON_OPT

# For thread sanitizer
build:tsan --strip=never
build:tsan --copt -fsanitize=thread
build:tsan --copt -g
build:tsan --copt -O1
build:tsan --copt -fno-omit-frame-pointer
build:tsan --linkopt -fsanitize=thread
