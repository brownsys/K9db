# Quickstart

Steps to start:
1. First time only: setup cargo-raze and use it to setup the bazel layout for
rust dependencies declared in Cargo.toml.
```bash
cargo install cargo-raze
cd <pelton_root>/mysql_proxy
cargo raze
cd <pelton_root>
```

2. Run with compiler optimizations
```bash
bazel run //mysql_proxy/src:mysql_proxy --config=opt
```

- Run with rust debug info printed on-screen
```bash
bazel run //mysql_proxy/src:mysql_proxy
```

- Run with FFI debug info printed on-screen
```bash
bazel run //mysql_proxy/src:mysql_proxy -- -alsologtostderr=true
```

3. Connect to the proxy using a mariadb client (from another terminal).
```bash
mariadb --port=10001 --host=127.0.0.1
```

# Summary
This proxy acts as a mysql database while interfacing with pelton. Queries are converted to C compatible types and sent to pelton. Responses are converted to rust compatible types and returned. Any application that uses a mysql backend may connect to this proxy instead of a traditional database.

- Coarse Grain  
Application <=> Mysql Proxy <=> Pelton

- Fine Grain  
Application <=> Mysql Proxy <=> FFI <=> C++ Wrappers <=> Pelton

# Design overview:
`mysql_proxy/src/main.rs` contains the code to start the proxy
`<bazel-bin>/mysql_proxy/src/proxy_ffi.rs` contains the FFI interface with C (automatically generated by bazel)
`mysql_proxy/src/proxy_wrappers.rs` contains functions which convert rust types to C, call the appropriate FFI functions into pelton, and return the response to the proxy
`mysql_proxy/src/ffi/ffi.h` contains the C/C++ API for the rust proxy. Its functions convert C++ types to C and pass query responses to rust via the FFI.  
